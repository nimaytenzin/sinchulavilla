<!-- Location Management Component -->
<div class="space-y-6 max-w-7xl mx-auto">
	<!-- Header -->
	<div class="flex justify-between items-center">
		<div>
			<h1 class="text-3xl font-bold text-gray-900 dark:text-white">
				Location Management
			</h1>
			<p class="text-gray-600 dark:text-gray-400 mt-1">
				Dzongkhag Master Table - used to manage locations/districts across
				Bhutan
			</p>
		</div>
		<div class="flex items-center gap-3">
			<p-button
				icon="pi pi-refresh"
				severity="secondary"
				[outlined]="true"
				(onClick)="refreshData()"
				pTooltip="Refresh Data"
			></p-button>
			<p-button
				icon="pi pi-download"
				severity="secondary"
				[outlined]="true"
				(onClick)="exportLocations()"
				pTooltip="Export Locations"
			></p-button>
		</div>
	</div>

	<!-- Success/Error Messages -->
	<div
		*ngIf="successMessage"
		class="p-4 mb-4 text-sm text-green-800 rounded-lg bg-green-50 dark:bg-gray-800 dark:text-green-400"
	>
		<div class="flex items-center">
			<i class="pi pi-check-circle mr-2"></i>
			{{ successMessage }}
		</div>
	</div>

	<div
		*ngIf="errorMessage"
		class="p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400"
	>
		<div class="flex items-center">
			<i class="pi pi-exclamation-triangle mr-2"></i>
			{{ errorMessage }}
		</div>
	</div>

	<!-- Search and Filters -->
	<div
		class="flex flex-col lg:flex-row gap-4 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm"
		*ngIf="showFilters"
	>
		<!-- Search Bar -->
		<div class="flex-1">
			<p-inputGroup>
				<p-inputGroupAddon>
					<i class="pi pi-search"></i>
				</p-inputGroupAddon>
				<input
					pInputText
					type="text"
					placeholder="Search locations..."
					[value]="searchQuery"
					(input)="onSearch($event)"
					class="w-full"
				/>
			</p-inputGroup>
		</div>

		<!-- Filters -->
		<div class="flex gap-3 items-center">
			<!-- Sort By -->
			<p-dropdown
				[options]="sortOptions"
				[(ngModel)]="filters.sortBy"
				(onChange)="onFilterChange()"
				optionLabel="label"
				optionValue="value"
				placeholder="Sort by"
				styleClass="min-w-[120px]"
			></p-dropdown>

			<!-- Sort Order -->
			<p-dropdown
				[options]="sortOrderOptions"
				[(ngModel)]="filters.sortOrder"
				(onChange)="onFilterChange()"
				optionLabel="label"
				optionValue="value"
				styleClass="min-w-[120px]"
			></p-dropdown>

			<!-- Add Button -->
			<p-button
				*ngIf="showAddButton"
				label="Add Location"
				icon="pi pi-plus"
				(onClick)="addLocation()"
				severity="primary"
			></p-button>
		</div>
	</div>

	<!-- Loading State -->
	<div class="flex justify-center items-center py-16" *ngIf="loading">
		<div class="text-center">
			<p-progressBar mode="indeterminate" styleClass="mb-4"></p-progressBar>
			<p class="text-slate-600">Loading locations...</p>
		</div>
	</div>

	<!-- Content Area -->
	<div *ngIf="!loading && filteredLocations.length > 0">
		<!-- Table View -->
		<div>
			<p-table
				[value]="filteredLocations"
				[paginator]="true"
				[rows]="pageSize"
				[showCurrentPageReport]="true"
				currentPageReportTemplate="Showing {first} to {last} of {totalRecords} locations"
				[rowsPerPageOptions]="[10, 25, 50]"
				styleClass="p-datatable-sm"
				responsiveLayout="scroll"
			>
				<ng-template pTemplate="header">
					<tr>
						<th class="w-16">ID</th>
						<th>Name</th>
						<th class="w-32">Created Date</th>
						<th class="w-48">Actions</th>
					</tr>
				</ng-template>

				<ng-template pTemplate="body" let-location>
					<tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
						<td>
							<span class="font-mono text-sm">#{{ location.id }}</span>
						</td>
						<td>
							<div class="flex items-center space-x-3">
								<div
									class="w-8 h-8 bg-gradient-to-br from-green-500 to-blue-600 rounded-full flex items-center justify-center"
								>
									<i class="pi pi-map-marker text-white text-sm"></i>
								</div>
								<span class="font-medium">{{ location.name }}</span>
							</div>
						</td>
						<td>
							<span class="text-sm text-gray-600 dark:text-gray-400">
								{{ formatDate(location.createdAt) }}
							</span>
						</td>
						<td>
							<div class="flex gap-2">
								<p-button
									icon="pi pi-eye"
									severity="info"
									[text]="true"
									size="small"
									(onClick)="viewLocationDetail(location)"
									pTooltip="View Details"
								></p-button>
								<p-button
									icon="pi pi-pencil"
									severity="secondary"
									[text]="true"
									size="small"
									(onClick)="editLocation(location)"
									pTooltip="Edit Location"
								></p-button>
								<p-button
									icon="pi pi-trash"
									severity="danger"
									[text]="true"
									size="small"
									(onClick)="deleteLocation(location)"
									pTooltip="Delete Location"
								></p-button>
							</div>
						</td>
					</tr>
				</ng-template>

				<ng-template pTemplate="emptymessage">
					<tr>
						<td colspan="4" class="text-center py-8">
							<div class="text-gray-500 dark:text-gray-400">
								<i class="pi pi-map-marker text-4xl mb-3 block"></i>
								<p class="text-lg">No locations found</p>
								<p class="text-sm">
									{{
										searchQuery
											? "Try adjusting your search criteria"
											: "Add your first location to get started"
									}}
								</p>
							</div>
						</td>
					</tr>
				</ng-template>
			</p-table>
		</div>
	</div>

	<!-- Empty State -->
	<div
		*ngIf="!loading && filteredLocations.length === 0"
		class="text-center py-16"
	>
		<div class="text-gray-500 dark:text-gray-400">
			<i class="pi pi-map-marker text-6xl mb-4 block"></i>
			<h3 class="text-xl font-semibold mb-2">No locations found</h3>
			<p class="text-sm mb-6">
				{{
					searchQuery
						? "No locations match your search criteria"
						: "Get started by adding your first location"
				}}
			</p>
			<p-button
				*ngIf="!searchQuery"
				label="Add Location"
				icon="pi pi-plus"
				(onClick)="addLocation()"
			></p-button>
		</div>
	</div>
</div>

<!-- Add/Edit Location Dialog -->
<p-dialog
	[(visible)]="showAddEditDialog"
	[header]="editingLocation ? 'Edit Location' : 'Add Location'"
	[modal]="true"
	[dismissableMask]="true"
	[style]="{ width: '500px' }"
	styleClass="p-fluid"
>
	<ng-template pTemplate="content">
		<div class="space-y-4">
			<!-- Location Name -->
			<div class="field">
				<label for="locationName" class="block text-sm font-medium mb-2"
					>Location Name <span class="text-red-500">*</span></label
				>
				<input
					pInputText
					id="locationName"
					[(ngModel)]="locationForm.name"
					placeholder="Enter location name"
					class="w-full"
					[class.ng-invalid]="
						showValidationErrors && !locationForm.name?.trim()
					"
				/>
				<small
					*ngIf="showValidationErrors && !locationForm.name?.trim()"
					class="text-red-500"
					>Location name is required</small
				>
			</div>
		</div>
	</ng-template>

	<ng-template pTemplate="footer">
		<div class="flex justify-end gap-3">
			<p-button
				label="Cancel"
				icon="pi pi-times"
				severity="secondary"
				[outlined]="true"
				(onClick)="hideDialog()"
			></p-button>
			<p-button
				[label]="editingLocation ? 'Update' : 'Create'"
				[icon]="editingLocation ? 'pi pi-check' : 'pi pi-plus'"
				severity="primary"
				(onClick)="saveLocation()"
				[loading]="loading"
			></p-button>
		</div>
	</ng-template>
</p-dialog>

<!-- Location Detail Dialog -->
<p-dialog
	[(visible)]="showLocationDetail"
	header="Location Details"
	[modal]="true"
	[dismissableMask]="true"
	[style]="{ width: '500px' }"
>
	<ng-template pTemplate="content" *ngIf="selectedLocation">
		<div class="space-y-4">
			<!-- Location Header -->
			<div
				class="text-center pb-4 border-b border-gray-200 dark:border-gray-700"
			>
				<div
					class="w-16 h-16 bg-gradient-to-br from-green-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-3"
				>
					<i class="pi pi-map-marker text-white text-2xl"></i>
				</div>
				<h3 class="text-xl font-semibold text-gray-900 dark:text-white">
					{{ selectedLocation.name }}
				</h3>
			</div>

			<!-- Location Details -->
			<div class="space-y-3">
				<div class="flex justify-between">
					<span class="text-gray-600 dark:text-gray-400">ID:</span>
					<span class="font-medium">#{{ selectedLocation.id }}</span>
				</div>
				<div class="flex justify-between">
					<span class="text-gray-600 dark:text-gray-400">Name:</span>
					<span class="font-medium">{{ selectedLocation.name }}</span>
				</div>
				<div class="flex justify-between">
					<span class="text-gray-600 dark:text-gray-400">Created:</span>
					<span class="font-medium">{{
						formatDate(selectedLocation.createdAt)
					}}</span>
				</div>
				<div class="flex justify-between" *ngIf="selectedLocation.updatedAt">
					<span class="text-gray-600 dark:text-gray-400">Last Updated:</span>
					<span class="font-medium">{{
						formatDate(selectedLocation.updatedAt)
					}}</span>
				</div>
			</div>
		</div>
	</ng-template>

	<ng-template pTemplate="footer">
		<div class="flex justify-end gap-3">
			<p-button
				label="Close"
				icon="pi pi-times"
				severity="secondary"
				[outlined]="true"
				(onClick)="hideDialog()"
			></p-button>
			<p-button
				label="Edit"
				icon="pi pi-pencil"
				severity="primary"
				(onClick)="editLocation(selectedLocation!); hideDialog()"
			></p-button>
		</div>
	</ng-template>
</p-dialog>

<!-- Confirmation Dialog -->
<p-confirmDialog></p-confirmDialog>

<!-- Toast Messages -->
<p-toast position="top-right"></p-toast>
