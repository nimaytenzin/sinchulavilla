<!-- Movie Listing Component -->

<!-- Admin Master Screening Component -->
<div class="min-h-screen bg-slate-50/50 p-4 sm:p-6">
	<!-- Header Section -->
	<div class="mb-6 sm:mb-8">
		<div
			class="bg-white rounded-2xl border border-slate-200/60 overflow-hidden"
		>
			<!-- Gradient Header Bar -->
			<div
				class="h-1 bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500"
			></div>

			<div class="p-6 sm:p-8">
				<div
					class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6"
				>
					<!-- Title Section -->
					<div class="flex-1 space-y-2">
						<div class="flex items-center gap-3 mb-2">
							<div
								class="w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center"
							>
								<i class="pi pi-calendar text-white text-lg"></i>
							</div>
							<h1 class="text-3xl sm:text-4xl font-bold text-slate-800">
								Movie Management
							</h1>
						</div>
						<p
							class="text-slate-600 text-base sm:text-lg leading-relaxed max-w-2xl"
						>
							Manage your movie collection, add new movies, and edit existing
							ones.
						</p>
					</div>

					<!-- Action Button -->
					<div class="flex-shrink-0">
						<p-button
							label="Add Movie"
							icon="pi pi-plus"
							styleClass=" !bg-blue-500 !border-none  !text-white !font-semibold !px-6 !py-3 !rounded-xl hover:!shadow-xl !hover:scale-101 !transition-all !duration-200"
							(onClick)="addMovie()"
						></p-button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Status Tabs -->
	<div *ngIf="!error" class="mb-6">
		<div
			class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4"
		>
			<p-tabView
				[activeIndex]="activeTabIndex"
				(onChange)="onTabChange($event)"
				styleClass="custom-tabs"
			>
				<p-tabPanel
					*ngFor="let tab of statusTabs; let i = index"
					[header]="tab.label"
					[selected]="i === activeTabIndex"
				>
					<ng-template pTemplate="header">
						<div class="flex items-center gap-2">
							<span>{{ tab.label }}</span>
						</div>
					</ng-template>
				</p-tabPanel>
			</p-tabView>
		</div>
	</div>

	<!-- Movies Content -->
	<div
		class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden"
	>
		<!-- Error State -->
		<div *ngIf="error" class="text-center py-16">
			<div class="p-8">
				<p-message severity="error" styleClass="w-full mb-4">
					<ng-template pTemplate>
						{{ error }}
					</ng-template>
				</p-message>
				<p-button
					label="Try Again"
					icon="pi pi-refresh"
					(onClick)="refreshMovies()"
					styleClass="interactive-button"
				>
				</p-button>
			</div>
		</div>

		<!-- Loading State -->
		<div
			*ngIf="loading && !error"
			class="flex justify-center items-center py-16"
		>
			<div class="text-center">
				<p-progressSpinner styleClass="w-12 h-12"></p-progressSpinner>
				<p class="mt-4 text-gray-500 dark:text-gray-400">Loading movies...</p>
			</div>
		</div>

		<!-- Table View -->
		<div *ngIf="!loading && !error" class="overflow-x-auto">
			<p-table
				[value]="movies"
				[responsive]="true"
				styleClass="p-datatable-gridlines w-full"
			>
				<ng-template pTemplate="header">
					<tr class="bg-gray-50 dark:bg-gray-900">
						<th
							class="text-left font-semibold text-gray-900 dark:text-white p-4"
							pSortableColumn="id"
						>
							ID <p-sortIcon field="id"></p-sortIcon>
						</th>
						<th
							class="text-left font-semibold text-gray-900 dark:text-white p-4"
						>
							Poster
						</th>
						<th
							class="text-left font-semibold text-gray-900 dark:text-white p-4"
							pSortableColumn="name"
						>
							Name <p-sortIcon field="name"></p-sortIcon>
						</th>
						<th
							class="text-left font-semibold text-gray-900 dark:text-white p-4"
						>
							Description
						</th>
						<th
							class="text-left font-semibold text-gray-900 dark:text-white p-4"
						>
							Genres
						</th>
						<th
							class="text-left font-semibold text-gray-900 dark:text-white p-4"
						>
							Languages
						</th>
						<th
							class="text-left font-semibold text-gray-900 dark:text-white p-4"
						>
							Subtitles
						</th>
						<th
							class="text-left font-semibold text-gray-900 dark:text-white p-4"
							pSortableColumn="pgRating"
						>
							Rating <p-sortIcon field="pgRating"></p-sortIcon>
						</th>
						<th
							class="text-left font-semibold text-gray-900 dark:text-white p-4"
							pSortableColumn="durationMin"
						>
							Duration <p-sortIcon field="durationMin"></p-sortIcon>
						</th>
						<th
							class="text-left font-semibold text-gray-900 dark:text-white p-4"
							pSortableColumn="releaseDate"
						>
							Release Date <p-sortIcon field="releaseDate"></p-sortIcon>
						</th>
						<th
							class="text-left font-semibold text-gray-900 dark:text-white p-4"
						>
							Status
						</th>
						<th
							class="text-left font-semibold text-gray-900 dark:text-white p-4"
						>
							Actions
						</th>
					</tr>
				</ng-template>

				<ng-template pTemplate="body" let-movie>
					<tr
						class="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
					>
						<td class="p-4 text-sm font-medium text-gray-900 dark:text-white">
							{{ movie.id }}
						</td>
						<td class="p-4">
							<div
								class="relative w-12 h-16 bg-gray-200 dark:bg-gray-700 rounded overflow-hidden group"
							>
								<!-- Movie Poster -->
								<img
									*ngIf="hasMoviePoster(movie)"
									[src]="getMoviePosterUrl(movie)"
									[alt]="movie.name"
									class="w-full h-full object-cover"
									(error)="onImageError($event)"
								/>

								<!-- Fallback Icon -->
								<div
									*ngIf="!hasMoviePoster(movie)"
									class="absolute inset-0 flex items-center justify-center"
								>
									<i class="pi pi-film text-lg text-gray-400"></i>
								</div>

								<!-- Upload button overlay -->
								<div
									class="absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center"
								>
									<p-button
										icon="pi pi-camera"
										size="small"
										severity="secondary"
										[rounded]="true"
										(onClick)="openMediaUpload(movie)"
										pTooltip="Upload Media"
										tooltipPosition="right"
									>
									</p-button>
								</div>
							</div>
						</td>
						<td class="p-4">
							<div class="font-medium text-gray-900 dark:text-white max-w-xs">
								{{ movie.name }}
							</div>
							<div
								class="text-sm text-gray-500 dark:text-gray-400"
								*ngIf="movie.productionHouse"
							>
								{{ movie.productionHouse }}
							</div>
							<p
								*ngIf="movie.producer"
								class="text-xs text-gray-500 dark:text-gray-400"
							>
								Produced By: {{ movie.producer.firstName }}
								{{ movie.producer.lastName }}
							</p>
						</td>
						<td class="p-4">
							<div class="max-w-xs">
								<p class="text-sm text-gray-900 dark:text-white line-clamp-2">
									{{ movie.description || "No description" }}
								</p>
								<p
									class="text-xs text-gray-500 dark:text-gray-400 mt-1"
									*ngIf="movie.casts"
								>
									<strong>Casts:</strong> {{ movie.casts }}
								</p>
							</div>
						</td>
						<td class="p-4">
							<div
								class="flex flex-wrap gap-1 max-w-32"
								*ngIf="movie.genres?.length; else noGenres"
							>
								<p-tag
									*ngFor="let genre of movie.genres"
									[value]="genre.name"
									severity="secondary"
									styleClass="text-xs"
								>
								</p-tag>
							</div>
							<ng-template #noGenres>
								<span class="text-gray-400 dark:text-gray-500 text-sm"
									>No genres</span
								>
							</ng-template>
						</td>
						<td class="p-4">
							<div
								class="flex flex-wrap gap-1 max-w-28"
								*ngIf="movie.languages?.length; else noLanguages"
							>
								<p-tag
									*ngFor="let language of movie.languages"
									[value]="language.code"
									severity="success"
									styleClass="text-xs"
								>
								</p-tag>
							</div>
							<ng-template #noLanguages>
								<span class="text-gray-400 dark:text-gray-500 text-sm"
									>No languages</span
								>
							</ng-template>
						</td>
						<td class="p-4">
							<div
								class="flex flex-wrap gap-1 max-w-28"
								*ngIf="movie.subtitleLanguages?.length; else noSubtitles"
							>
								<p-tag
									*ngFor="let subtitle of movie.subtitleLanguages"
									[value]="subtitle.code"
									severity="warning"
									styleClass="text-xs"
								>
								</p-tag>
							</div>
							<ng-template #noSubtitles>
								<span class="text-gray-400 dark:text-gray-500 text-sm"
									>No subtitles</span
								>
							</ng-template>
						</td>
						<td class="p-4">
							<p-tag
								[value]="movie.pgRating || 'N/A'"
								severity="info"
								styleClass="text-sm"
							></p-tag>
						</td>
						<td class="p-4 text-sm text-gray-900 dark:text-white font-medium">
							{{ formatDuration(movie.durationMin || 0) }}
						</td>
						<td class="p-4 text-sm text-gray-900 dark:text-white">
							{{ formatDate(movie.releaseDate || "") }}
						</td>
						<td class="p-4">
							<p-tag
								[value]="getStatusText(movie.screeningStatus)"
								[severity]="getStatusSeverity(movie.screeningStatus)"
								styleClass="text-sm"
							>
							</p-tag>
						</td>
						<td class="p-4">
							<div class="flex gap-1 flex-wrap">
								<p-button
									icon="pi pi-eye"
									size="small"
									severity="info"
									[text]="true"
									(onClick)="viewMovieDetails(movie)"
									pTooltip="View Details"
									styleClass="interactive-button"
								>
								</p-button>
								<p-button
									icon="pi pi-camera"
									size="small"
									severity="secondary"
									[text]="true"
									(onClick)="openMediaUpload(movie)"
									pTooltip="Upload Media"
									styleClass="interactive-button"
								>
								</p-button>
								<p-button
									icon="pi pi-pencil"
									size="small"
									[text]="true"
									(onClick)="editMovie(movie)"
									pTooltip="Edit movie"
									styleClass="interactive-button"
								>
								</p-button>
								<p-button
									icon="pi pi-trash"
									severity="danger"
									size="small"
									[text]="true"
									(onClick)="deleteMovie(movie)"
									pTooltip="Delete movie"
									styleClass="interactive-button"
								>
								</p-button>
							</div>
						</td>
					</tr>
				</ng-template>

				<ng-template pTemplate="emptymessage">
					<tr>
						<td colspan="12" class="text-center py-12">
							<div class="text-gray-500 dark:text-gray-400">
								<i
									class="pi pi-film text-6xl mb-6 block text-gray-300 dark:text-gray-600"
								></i>
								<h3
									class="text-xl font-semibold text-gray-700 dark:text-gray-300 mb-3"
								>
									No {{ currentTabLabel.toLowerCase() }} Movies found
								</h3>
								<p class="text-sm text-gray-500 dark:text-gray-400 mb-6">
									There are no movies with "{{ currentTabLabel }}" status at the
									moment.
								</p>
							</div>
						</td>
					</tr>
				</ng-template>
			</p-table>
		</div>

		<!-- Pagination -->
		<div
			*ngIf="!loading && !error && totalRecords > 0"
			class="border-t border-gray-200 dark:border-gray-700 p-4 bg-gray-50 dark:bg-gray-900"
		>
			<p-paginator
				[rows]="pageSize"
				[totalRecords]="totalRecords"
				[first]="(currentPage - 1) * pageSize"
				(onPageChange)="onPageChange($event)"
				[showCurrentPageReport]="true"
				currentPageReportTemplate="Showing {first} to {last} of {totalRecords} {{
					currentTabLabel.toLowerCase()
				}}"
				styleClass="p-paginator-default"
			>
			</p-paginator>
		</div>
	</div>
</div>
