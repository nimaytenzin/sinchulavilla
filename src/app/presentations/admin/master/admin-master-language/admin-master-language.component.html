<!-- Language Management Component -->
<div class="space-y-6 max-w-7xl mx-auto">
	<!-- Header -->
	<div class="flex justify-between items-center">
		<div>
			<h1 class="text-3xl font-bold text-gray-900 dark:text-white">
				Language Management
			</h1>
			<p class="text-gray-600 dark:text-gray-400 mt-1">
				Language Master Table - used to set movie language and movie subtitle
				language
			</p>
		</div>
		<div class="flex items-center gap-3">
			<p-button
				icon="pi pi-refresh"
				severity="secondary"
				[outlined]="true"
				(onClick)="refreshData()"
				pTooltip="Refresh Data"
			></p-button>
			<p-button
				icon="pi pi-download"
				severity="secondary"
				[outlined]="true"
				(onClick)="exportLanguages()"
				pTooltip="Export Languages"
			></p-button>
		</div>
	</div>

	<!-- Success/Error Messages -->
	<div
		*ngIf="successMessage"
		class="p-4 mb-4 text-sm text-green-800 rounded-lg bg-green-50 dark:bg-gray-800 dark:text-green-400"
	>
		<div class="flex items-center">
			<i class="pi pi-check-circle mr-2"></i>
			{{ successMessage }}
		</div>
	</div>

	<div
		*ngIf="errorMessage"
		class="p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400"
	>
		<div class="flex items-center">
			<i class="pi pi-exclamation-triangle mr-2"></i>
			{{ errorMessage }}
		</div>
	</div>

	<!-- Search and Filter Bar -->
	<div
		class="flex justify-between items-center gap-4 flex-wrap"
		*ngIf="showFilters"
	>
		<div class="flex-1 max-w-md">
			<p-inputGroup>
				<p-inputGroupAddon>
					<i class="pi pi-search"></i>
				</p-inputGroupAddon>
				<input
					type="text"
					pInputText
					placeholder="Search languages..."
					[(ngModel)]="searchQuery"
					(input)="onSearchChange()"
					class="w-full"
				/>
				<p-inputGroupAddon *ngIf="searchQuery">
					<i class="pi pi-times cursor-pointer" (click)="clearSearch()"></i>
				</p-inputGroupAddon>
			</p-inputGroup>
		</div>

		<div class="flex items-center gap-4">
			<!-- Sort By -->
			<p-dropdown
				[options]="sortOptions"
				[(ngModel)]="filters.sortBy"
				(onChange)="applyFilters()"
				optionLabel="label"
				optionValue="value"
				styleClass="min-w-[130px]"
			></p-dropdown>

			<!-- Sort Order -->
			<p-dropdown
				[options]="sortOrderOptions"
				[(ngModel)]="filters.sortOrder"
				(onChange)="applyFilters()"
				optionLabel="label"
				optionValue="value"
				styleClass="min-w-[130px]"
			></p-dropdown>

			<!-- Add Button -->
			<p-button
				*ngIf="showAddButton"
				label="Add Language"
				icon="pi pi-plus"
				(onClick)="addLanguage()"
				severity="primary"
			></p-button>
		</div>
	</div>

	<!-- Loading State -->
	<div class="flex justify-center items-center py-16" *ngIf="loading">
		<div class="text-center">
			<p-progressBar mode="indeterminate" styleClass="mb-4"></p-progressBar>
			<p class="text-slate-600">Loading languages...</p>
		</div>
	</div>

	<!-- Content Area -->
	<div *ngIf="!loading && filteredLanguages.length > 0">
		<!-- Table View -->
		<p-table
			[value]="filteredLanguages"
			dataKey="id"
			[rowHover]="true"
			styleClass="p-datatable-sm"
			[sortField]="filters.sortBy"
			[sortOrder]="filters.sortOrder === 'asc' ? 1 : -1"
		>
			<ng-template pTemplate="header">
				<tr>
					<th pSortableColumn="name">
						Language Name
						<p-sortIcon field="name"></p-sortIcon>
					</th>
					<th pSortableColumn="code">
						Code
						<p-sortIcon field="code"></p-sortIcon>
					</th>
					<th pSortableColumn="createdAt">
						Created Date
						<p-sortIcon field="createdAt"></p-sortIcon>
					</th>
					<th>Actions</th>
				</tr>
			</ng-template>

			<ng-template pTemplate="body" let-language>
				<tr>
					<td>
						<div class="flex items-center gap-3">
							<div
								class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center"
							>
								<span class="text-white font-bold text-xs">{{
									(language.code || "N/A").toUpperCase()
								}}</span>
							</div>
							<span class="font-medium">{{ language.name }}</span>
						</div>
					</td>
					<td>
						<p-tag [value]="language.code || 'N/A'" severity="info"></p-tag>
					</td>
					<td>{{ language.createdAt | date : "MMM dd, yyyy" }}</td>
					<td class="text-center">
						<div class="flex justify-center gap-1">
							<p-button
								icon="pi pi-pencil"
								severity="secondary"
								size="small"
								[text]="true"
								(onClick)="editLanguage(language)"
								pTooltip="Edit Language"
							></p-button>
							<p-button
								icon="pi pi-trash"
								severity="danger"
								size="small"
								[text]="true"
								(onClick)="deleteLanguage(language)"
								pTooltip="Delete Language"
							></p-button>
						</div>
					</td>
				</tr>
			</ng-template>
		</p-table>
	</div>

	<!-- Empty State -->
	<div
		*ngIf="!loading && filteredLanguages.length === 0"
		class="text-center py-16 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700"
	>
		<div class="flex flex-col items-center gap-4">
			<i class="pi pi-globe text-6xl text-gray-400"></i>
			<div class="text-gray-500 dark:text-gray-400">
				<h3 class="text-xl font-medium mb-2">No languages found</h3>
				<p class="text-sm max-w-md mx-auto">
					{{
						searchQuery
							? "No languages match your search criteria. Try different keywords or clear the search."
							: "Get started by adding your first language to the system."
					}}
				</p>
			</div>
			<div class="flex gap-3">
				<p-button
					*ngIf="searchQuery"
					label="Clear Search"
					icon="pi pi-filter-slash"
					severity="secondary"
					outlined="true"
					(onClick)="clearSearch()"
				>
				</p-button>
				<p-button
					label="Add Language"
					icon="pi pi-plus"
					(onClick)="addLanguage()"
				>
				</p-button>
			</div>
		</div>
	</div>
</div>

<!-- Add/Edit Language Dialog -->
<p-dialog
	[(visible)]="showAddEditDialog"
	[header]="editingLanguage ? 'Edit Language' : 'Add New Language'"
	[modal]="true"
	[style]="{ width: '40vw', maxWidth: '500px' }"
	[draggable]="false"
	[resizable]="false"
>
	<form class="space-y-6">
		<div>
			<label for="languageName" class="block text-sm font-medium mb-2"
				>Language Name *</label
			>
			<input
				pInputText
				id="languageName"
				[(ngModel)]="languageForm.name"
				name="languageName"
				placeholder="Enter language name"
				class="w-full"
				[class.border-red-500]="!languageForm.name && showValidationErrors"
				required
			/>
			<small
				*ngIf="!languageForm.name && showValidationErrors"
				class="text-red-500 mt-1"
			>
				Language name is required
			</small>
		</div>

		<div>
			<label for="languageCode" class="block text-sm font-medium mb-2"
				>Language Code *</label
			>
			<input
				pInputText
				id="languageCode"
				[(ngModel)]="languageForm.code"
				name="languageCode"
				placeholder="e.g., en, dz, hi"
				class="w-full"
				maxlength="2"
				style="text-transform: lowercase"
				(input)="onLanguageCodeInput($event)"
				[class.border-red-500]="
					(!languageForm.code ||
						!isValidLanguageCode(languageForm.code || '')) &&
					showValidationErrors
				"
				required
			/>
			<small class="text-gray-500">ISO 639-1 two-letter language code</small>
			<small
				*ngIf="
					languageForm.code &&
					!isValidLanguageCode(languageForm.code) &&
					showValidationErrors
				"
				class="text-red-500 mt-1 block"
			>
				Language code must be exactly 2 lowercase letters
			</small>
			<small
				*ngIf="!languageForm.code && showValidationErrors"
				class="text-red-500 mt-1 block"
			>
				Language code is required
			</small>
		</div>
	</form>

	<ng-template pTemplate="footer">
		<div class="flex gap-2">
			<p-button
				label="Cancel"
				icon="pi pi-times"
				severity="secondary"
				outlined="true"
				(onClick)="closeAddEditDialog()"
			></p-button>
			<p-button
				[label]="editingLanguage ? 'Update' : 'Save'"
				icon="pi pi-check"
				severity="primary"
				(onClick)="saveLanguage()"
				[disabled]="!languageForm.name || !languageForm.code"
			></p-button>
		</div>
	</ng-template>
</p-dialog>

<!-- Confirmation Dialog -->
<p-confirmDialog
	[style]="{ width: '450px' }"
	[baseZIndex]="10000"
	acceptButtonStyleClass="p-button-danger"
	rejectButtonStyleClass="p-button-secondary p-button-outlined"
></p-confirmDialog>
