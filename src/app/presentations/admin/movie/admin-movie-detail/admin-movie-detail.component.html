<!-- Movie Detail Component -->
<div class="min-h-screen bg-gray-50 dark:bg-gray-900">
	<!-- Loading State -->
	<div *ngIf="loading" class="flex justify-center items-center min-h-screen">
		<div class="text-center">
			<p-progressBar mode="indeterminate" styleClass="w-64"></p-progressBar>
			<p class="mt-4 text-gray-600 dark:text-gray-400">
				Loading movie details...
			</p>
		</div>
	</div>

	<!-- Error State -->
	<div
		*ngIf="error && !loading"
		class="flex justify-center items-center min-h-screen"
	>
		<div class="text-center">
			<p-message severity="error" styleClass="w-full max-w-md">
				<ng-template pTemplate>
					{{ error }}
				</ng-template>
			</p-message>
			<div class="flex gap-3 mt-6 justify-center">
				<p-button
					label="Go Back"
					icon="pi pi-arrow-left"
					(onClick)="goBack()"
					severity="secondary"
				>
				</p-button>
				<p-button
					label="Retry"
					icon="pi pi-refresh"
					(onClick)="loadMovieDetails(movie?.id || 0)"
				>
				</p-button>
			</div>
		</div>
	</div>

	<!-- Movie Content -->
	<div *ngIf="!loading && !error && movie" class="pb-8">
		<!-- Header Section -->
		<div class="">
			<div class="max-w-7xl mx-auto px-6 py-8">
				<!-- Navigation -->
				<div class="flex items-center justify-between mb-6">
					<div class="flex items-center">
						<p-button
							icon="pi pi-arrow-left"
							(onClick)="goBack()"
							pTooltip="Back to Movies"
							label="Back to Movies"
							[outlined]="true"
						>
						</p-button>
						<span class="mx-3 text-white/60">|</span>
						<span class="text-white/80">Movie Details</span>
					</div>

					<!-- Action Buttons -->
					<div class="flex items-center gap-3">
						<p-button
							label="Edit Movie"
							icon="pi pi-pencil"
							[outlined]="true"
							(onClick)="toggleEditMode()"
							styleClass="text-white border-white hover:bg-white hover:text-blue-600"
						>
						</p-button>
					</div>
				</div>

				<!-- Movie Header Info -->
				<div class="grid md:grid-cols-3 gap-8">
					<!-- Movie Poster -->
					<div class="md:col-span-1">
						<div class="relative group">
							<!-- Poster Image -->
							<div class="relative overflow-hidden">
								<img
									*ngIf="getFirstPortraitImage()"
									[src]="getMediaUrl(getFirstPortraitImage().uri)"
									[alt]="movie.name"
									class="w-full max-w-xs mx-auto aspect-[2/3] object-contain transform transition-transform duration-300 group-hover:scale-105"
									(error)="onImageError($event)"
								/>
								<!-- Placeholder when no portrait media -->
								<div
									*ngIf="!getFirstPortraitImage()"
									class="w-full max-w-xs mx-auto aspect-[2/3] bg-gradient-to-br from-gray-700 via-gray-800 to-gray-900 rounded-lg flex flex-col items-center justify-center text-gray-400"
								>
									<i class="pi pi-film text-6xl mb-4"></i>
									<p class="text-sm font-medium">
										No Portrait Poster Available
									</p>
									<p class="text-xs text-gray-500 text-center px-4 mt-2">
										Upload a portrait image in media gallery
									</p>
								</div>

								<!-- Loading shimmer overlay -->
								<div
									*ngIf="loading"
									class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -skew-x-12 animate-pulse"
								></div>
							</div>

							<!-- Media Count Badge -->
							<div
								*ngIf="getFirstPortraitImage()"
								class="absolute top-3 left-3 bg-black/70 backdrop-blur-sm text-white px-2 py-1 rounded-full text-xs font-medium"
							>
								{{ movie.media.length }} media
							</div>

							<!-- Play Trailer Button -->
							<div
								*ngIf="movie.trailerURL"
								class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300"
							>
								<div class="relative">
									<div
										class="absolute inset-0 bg-white/20 rounded-full blur-xl"
									></div>
									<p-button
										icon="pi pi-play"
										[rounded]="true"
										size="large"
										(onClick)="openTrailer()"
										pTooltip="Watch Trailer"
										styleClass="relative bg-white/20 backdrop-blur-sm hover:bg-white/30 border-white/30 text-white"
									>
									</p-button>
								</div>
							</div>

							<!-- No Trailer Indicator -->
							<div
								*ngIf="!movie.trailerURL"
								class="absolute bottom-3 right-3 bg-yellow-500/80 text-white px-2 py-1 rounded text-xs font-medium"
							>
								No Trailer
							</div>
						</div>
					</div>

					<!-- Movie Info -->
					<div class="md:col-span-2 space-y-6">
						<!-- Movie Title and Production House -->
						<div>
							<h1 class="text-4xl font-bold mb-2">{{ movie.name }}</h1>
							<p class="text-xl" *ngIf="movie.productionHouse">
								{{ movie.productionHouse }}
							</p>
						</div>

						<!-- Description -->
						<p class="text-lg leading-relaxed">
							{{ movie.description || "No description available" }}
						</p>

						<!-- Movie Details Grid -->
						<div class="grid grid-cols-2 md:grid-cols-4 gap-4">
							<div class="text-center p-4">
								<p class="text-sm">Duration</p>
								<p class="text-xl font-semibold">
									{{ formatDuration(movie.durationMin || 0) }}
								</p>
							</div>
							<div class="text-center p-4">
								<p class="text-sm">Rating</p>
								<p class="text-xl font-semibold">
									{{ movie.pgRating || "N/A" }}
								</p>
							</div>
							<div class="text-center p-4">
								<p class="text-sm">Release</p>
								<p class="text-xl font-semibold">
									{{ formatDate(movie.releaseDate || "") }}
								</p>
							</div>
							<div class="text-center p-4">
								<p class="text-sm">Status</p>
								<p-tag
									[value]="getStatusText(movie.screeningStatus)"
									[severity]="getStatusSeverity(movie.screeningStatus)"
									styleClass="text-sm"
								>
								</p-tag>
							</div>
						</div>

						<div class="flex flex-wrap gap-6">
							<div *ngIf="movie.genres?.length">
								<h3 class="text-sm font-medium mb-2">Genres</h3>
								<div class="flex flex-wrap gap-2">
									<p-tag
										*ngFor="let genre of movie.genres"
										[value]="genre.name"
										severity="secondary"
										styleClass="bg-white/20 text-white"
									>
									</p-tag>
								</div>
							</div>

							<div *ngIf="movie.languages?.length">
								<h3 class="text-sm font-medium mb-2">Languages</h3>
								<div class="flex flex-wrap gap-2">
									<p-tag
										*ngFor="let language of movie.languages"
										[value]="language.name"
										severity="success"
										styleClass="bg-green-500/20 text-green-100"
									>
									</p-tag>
								</div>
							</div>

							<div *ngIf="movie.subtitleLanguages?.length">
								<h3 class="text-sm font-medium mb-2">Subtitles</h3>
								<div class="flex flex-wrap gap-2">
									<p-tag
										*ngFor="let subtitle of movie.subtitleLanguages"
										[value]="subtitle.name"
										severity="warning"
										styleClass="bg-yellow-500/20 text-yellow-100"
									>
									</p-tag>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Tab View for Movie Details & Screenings -->
		<div class="max-w-7xl mx-auto px-6 py-8">
			<p-tabView [(activeIndex)]="activeTabIndex" styleClass="custom-tabview">
				<!-- Statistics Tab -->
				<p-tabPanel header="Statistics & Analytics">
					<div class="bg-white dark:bg-gray-800 rounded-lg p-6">
						<app-admin-movie-statistics
							[movie]="movie"
						></app-admin-movie-statistics>
					</div>
				</p-tabPanel>

				<!-- Media Gallery Tab -->
				<p-tabPanel header="Media Gallery">
					<div class="bg-white dark:bg-gray-800 rounded-lg p-6">
						<app-admin-movie-details-media-tab
							[movieId]="movie.id"
						></app-admin-movie-details-media-tab>
					</div>
				</p-tabPanel>
			</p-tabView>
		</div>
	</div>

	<!-- Trailer Dialog -->
	<p-dialog
		[(visible)]="showTrailerDialog"
		[modal]="true"
		[draggable]="false"
		[resizable]="false"
		[style]="{ width: '90vw', maxWidth: '1200px' }"
		header="Movie Trailer"
		[dismissableMask]="true"
		(onHide)="closeTrailer()"
	>
		<div class="relative w-full" style="padding-top: 56.25%">
			<iframe
				*ngIf="safeTrailerUrl"
				[src]="safeTrailerUrl"
				class="absolute top-0 left-0 w-full h-full rounded-lg"
				frameborder="0"
				allowfullscreen
			></iframe>
		</div>
	</p-dialog>

	<!-- Edit Movie Dialog -->
	<p-dialog
		[(visible)]="showEditDialog"
		[modal]="true"
		[draggable]="false"
		[resizable]="false"
		[style]="{ width: '90vw', maxWidth: '800px' }"
		header="Edit Movie Details"
		[dismissableMask]="false"
		[closable]="false"
	>
		<div *ngIf="editMovie" class="space-y-6">
			<!-- Basic Information -->
			<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
				<div>
					<label
						class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
					>
						Movie Title <span class="text-red-500">*</span>
					</label>
					<input
						type="text"
						[(ngModel)]="editMovie.name"
						class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"
						placeholder="Enter movie title"
						required
					/>
				</div>
				<div>
					<label
						class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
					>
						Production House
					</label>
					<input
						type="text"
						[(ngModel)]="editMovie.productionHouse"
						class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"
						placeholder="Enter production house"
					/>
				</div>
			</div>

			<!-- Description -->
			<div>
				<label
					class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
				>
					Description
				</label>
				<textarea
					[(ngModel)]="editMovie.description"
					rows="4"
					class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none dark:bg-gray-700 dark:text-white"
					placeholder="Enter movie description"
				></textarea>
			</div>

			<!-- Movie Details -->
			<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
				<div>
					<label
						class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
					>
						Duration (minutes)
					</label>
					<input
						type="number"
						[(ngModel)]="editMovie.durationMin"
						min="1"
						class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"
						placeholder="Enter duration in minutes"
					/>
				</div>
				<div>
					<label
						class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
					>
						PG Rating
					</label>
					<input
						type="text"
						[(ngModel)]="editMovie.pgRating"
						class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"
						placeholder="Enter PG rating (e.g., PG-13, R)"
					/>
				</div>
			</div>

			<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
				<div>
					<label
						class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
					>
						Release Date
					</label>
					<input
						type="date"
						[(ngModel)]="editMovie.releaseDate"
						class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"
					/>
				</div>
				<div>
					<label
						class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
					>
						Trailer URL
					</label>
					<input
						type="url"
						[(ngModel)]="editMovie.trailerURL"
						class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"
						placeholder="Enter YouTube trailer URL"
					/>
				</div>
			</div>

			<!-- Action Buttons -->
			<div
				class="flex justify-end gap-3 pt-6 border-t border-gray-200 dark:border-gray-700"
			>
				<p-button
					label="Cancel"
					icon="pi pi-times"
					[outlined]="true"
					severity="secondary"
					(onClick)="cancelEdit()"
				>
				</p-button>
				<p-button
					label="Save Changes"
					icon="pi pi-check"
					[loading]="loading"
					(onClick)="saveMovie()"
				>
				</p-button>
			</div>
		</div>
	</p-dialog>
</div>
