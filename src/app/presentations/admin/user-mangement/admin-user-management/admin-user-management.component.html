<div class="bg-white p-6 rounded-lg shadow-sm">
	<!-- Header Section -->
	<div class="flex justify-between items-center mb-6">
		<div>
			<h2 class="text-2xl font-bold text-gray-800">User Management</h2>
			<p class="text-gray-600 mt-1">
				Manage admins, theatre managers, executive producers, and counter staff
			</p>
		</div>
		<div class="flex gap-3">
			<button
				pButton
				type="button"
				icon="pi pi-refresh"
				label="Refresh"
				class="p-button-outlined"
				(click)="refreshUsers()"
				[loading]="loading"
			></button>
			<button
				pButton
				type="button"
				icon="pi pi-plus"
				label="Add User"
				(click)="openNew()"
			></button>
		</div>
	</div>

	<!-- Toast Messages -->
	<p-toast position="top-right"></p-toast>

	<!-- Filters Section -->
	<div
		class="bg-gray-50 p-4 rounded-lg mb-6 grid grid-cols-1 md:grid-cols-4 gap-4"
	>
		<div>
			<label class="block text-sm font-medium text-gray-700 mb-2"
				>Role Filter</label
			>
			<p-dropdown
				[options]="roleOptions"
				[(ngModel)]="selectedRole"
				optionLabel="label"
				optionValue="value"
				placeholder="Select Role"
				(onChange)="onRoleFilterChange()"
				class="w-full"
			></p-dropdown>
		</div>

		<div>
			<label class="block text-sm font-medium text-gray-700 mb-2">Search</label>
			<input
				pInputText
				type="text"
				[(ngModel)]="searchText"
				placeholder="Search by name, email, phone..."
				(input)="onSearchChange()"
				class="w-full"
			/>
		</div>
	</div>

	<!-- Users Table -->
	<div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
		<p-table
			[value]="users"
			[columns]="cols"
			[loading]="loading"
			[paginator]="true"
			[rows]="25"
			[showCurrentPageReport]="true"
			currentPageReportTemplate="Showing {first} to {last} of {totalRecords} users"
			[rowsPerPageOptions]="[10, 25, 50]"
			responsiveLayout="scroll"
			styleClass="p-datatable-sm"
		>
			<!-- Table Header -->
			<ng-template pTemplate="header" let-columns>
				<tr>
					<th
						class="bg-gray-50 text-gray-700 font-semibold py-3 px-4 text-left"
					>
						ID
					</th>
					<th
						class="bg-gray-50 text-gray-700 font-semibold py-3 px-4 text-left"
					>
						Profile
					</th>
					<th
						class="bg-gray-50 text-gray-700 font-semibold py-3 px-4 text-left"
					>
						Name
					</th>
					<th
						class="bg-gray-50 text-gray-700 font-semibold py-3 px-4 text-left"
					>
						Contact
					</th>
					<th
						class="bg-gray-50 text-gray-700 font-semibold py-3 px-4 text-left"
					>
						Role
					</th>
					<th
						class="bg-gray-50 text-gray-700 font-semibold py-3 px-4 text-left"
					>
						Login Access
					</th>
					<th
						class="bg-gray-50 text-gray-700 font-semibold py-3 px-4 text-left"
					>
						Last Login
					</th>
					<th
						class="bg-gray-50 text-gray-700 font-semibold py-3 px-4 text-left"
					>
						Actions
					</th>
				</tr>
			</ng-template>

			<!-- Table Body -->
			<ng-template pTemplate="body" let-user>
				<tr class="hover:bg-gray-50 border-b border-gray-100">
					<!-- ID -->
					<td class="py-3 px-4">
						<span class="font-mono text-sm text-gray-600">#{{ user.id }}</span>
					</td>

					<!-- Profile Image -->
					<td class="py-3 px-4">
						<div
							class="w-10 h-10 rounded-full overflow-hidden bg-gray-200 flex items-center justify-center"
						>
							<img
								*ngIf="user.profileImage"
								[src]="user.profileImage"
								[alt]="getFullName(user)"
								class="w-full h-full object-cover"
							/>
							<i
								*ngIf="!user.profileImage"
								class="pi pi-user text-gray-500"
							></i>
						</div>
					</td>

					<!-- Name -->
					<td class="py-3 px-4">
						<div>
							<div class="font-medium text-gray-900">
								{{ getFullName(user) }}
							</div>
							<div class="text-sm text-gray-500" *ngIf="user.address">
								{{ user.address }}
							</div>
						</div>
					</td>

					<!-- Contact -->
					<td class="py-3 px-4">
						<div>
							<div class="text-gray-700">{{ user.phoneNumber }}</div>
							<div class="text-sm text-gray-500" *ngIf="user.email">
								{{ user.email }}
							</div>
						</div>
					</td>

					<!-- Role -->
					<td class="py-3 px-4">
						<p-tag
							[value]="user.role"
							[severity]="getRoleSeverity(user.role)"
							class="text-xs"
						></p-tag>
					</td>

					<!-- Status -->
					<td class="py-3 px-4">
						<div class="flex gap-2">
							<p-tag
								[value]="user.hasLoginAccess ? 'Enabled' : 'Disabled'"
								[severity]="user.hasLoginAccess ? 'success' : 'danger'"
								class="text-xs"
							></p-tag>
						</div>
					</td>

					<!-- Last Login -->
					<td class="py-3 px-4">
						<span class="text-sm text-gray-600">{{
							formatDate(user.lastLoginAt)
						}}</span>
					</td>

					<!-- Actions -->
					<td class="py-3 px-4">
						<div class="flex gap-2">
							<button
								pButton
								icon="pi pi-pencil"
								class="p-button-text p-button-sm"
								(click)="editUser(user)"
								pTooltip="Edit User"
							></button>

							<button
								pButton
								[icon]="user.hasLoginAccess ? 'pi pi-lock' : 'pi pi-unlock'"
								class="p-button-text p-button-sm"
								[class]="
									user.hasLoginAccess ? 'p-button-danger' : 'p-button-info'
								"
								(click)="toggleLoginAccess(user)"
								[pTooltip]="
									user.hasLoginAccess ? 'Disable Login' : 'Enable Login'
								"
							></button>

							<button
								pButton
								icon="pi pi-key"
								class="p-button-text p-button-sm p-button-secondary"
								(click)="openResetPasswordDialog(user)"
								pTooltip="Reset Password"
							></button>
						</div>
					</td>
				</tr>
			</ng-template>

			<!-- Empty State -->
			<ng-template pTemplate="emptymessage">
				<tr>
					<td colspan="8" class="text-center py-8">
						<div class="flex flex-col items-center">
							<i class="pi pi-users text-4xl text-gray-400 mb-3"></i>
							<p class="text-gray-500 text-lg">No users found</p>
							<p class="text-gray-400 text-sm">
								Add your first user to get started
							</p>
						</div>
					</td>
				</tr>
			</ng-template>

			<!-- Loading Template -->
			<ng-template pTemplate="loadingbody">
				<tr>
					<td colspan="8" class="text-center py-8">
						<div class="flex flex-col items-center">
							<i class="pi pi-spin pi-spinner text-2xl text-blue-500 mb-3"></i>
							<p class="text-gray-500">Loading users...</p>
						</div>
					</td>
				</tr>
			</ng-template>
		</p-table>
	</div>

	<!-- Reset Password Dialog -->
	<p-dialog
		[(visible)]="resetPasswordDialog"
		header="Reset Password"
		[modal]="true"
		[style]="{ width: '450px' }"
		[draggable]="false"
		[resizable]="false"
		(onHide)="closeResetPasswordDialog()"
	>
		<ng-template pTemplate="content">
			<div class="space-y-4">
				<div class="flex items-center mb-4">
					<i class="pi pi-key mr-3 text-2xl text-blue-500"></i>
					<span *ngIf="selectedUser">
						Reset password for
						<strong>{{ getFullName(selectedUser) }}</strong>
					</span>
				</div>

				<div>
					<label class="block text-sm font-medium text-gray-700 mb-2">
						New Password <span class="text-red-500">*</span>
					</label>
					<input
						pInputText
						type="password"
						[(ngModel)]="resetPasswordForm.newPassword"
						placeholder="Enter new password"
						class="w-full"
						[disabled]="resetPasswordLoading"
					/>
				</div>

				<div>
					<label class="block text-sm font-medium text-gray-700 mb-2">
						Confirm New Password <span class="text-red-500">*</span>
					</label>
					<input
						pInputText
						type="password"
						[(ngModel)]="resetPasswordForm.newPasswordAgain"
						placeholder="Confirm new password"
						class="w-full"
						[disabled]="resetPasswordLoading"
					/>
				</div>

				<div class="text-sm text-gray-600">
					<i class="pi pi-info-circle mr-2"></i>
					Password must be at least 6 characters long.
				</div>
			</div>
		</ng-template>

		<ng-template pTemplate="footer">
			<div class="flex justify-end gap-3">
				<button
					pButton
					label="Cancel"
					icon="pi pi-times"
					class="p-button-outlined p-button-secondary"
					(click)="closeResetPasswordDialog()"
					[disabled]="resetPasswordLoading"
				></button>
				<button
					pButton
					label="Reset Password"
					icon="pi pi-key"
					class="p-button-success"
					(click)="confirmResetPassword()"
					[loading]="resetPasswordLoading"
				></button>
			</div>
		</ng-template>
	</p-dialog>

	<!-- Confirmation Dialog -->
	<p-confirmDialog></p-confirmDialog>
</div>
