<!-- Admin Master Screening Component -->
<div class="min-h-screen bg-slate-50/50 p-4 sm:p-6">
	<!-- Header Section -->
	<div class="mb-6 sm:mb-8">
		<div
			class="bg-white rounded-2xl border border-slate-200/60 overflow-hidden"
		>
			<!-- Gradient Header Bar -->
			<div
				class="h-1 bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500"
			></div>

			<div class="p-6 sm:p-8">
				<div
					class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6"
				>
					<!-- Title Section -->
					<div class="flex-1 space-y-2">
						<div class="flex items-center gap-3 mb-2">
							<div
								class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center"
							>
								<i class="pi pi-calendar text-white text-lg"></i>
							</div>
							<h1 class="text-3xl sm:text-4xl font-bold text-slate-800">
								Screening Management
							</h1>
						</div>
						<p
							class="text-slate-600 text-base sm:text-lg leading-relaxed max-w-2xl"
						>
							Manage movie screenings, showtimes, and pricing across all
							theaters
						</p>
					</div>

					<!-- Action Button -->
					<div class="flex-shrink-0">
						<p-button
							label="Add Screening"
							icon="pi pi-plus"
							(onClick)="openCreateDialog()"
							styleClass=" !bg-blue-500 !border-none  !text-white !font-semibold !px-6 !py-3 !rounded-xl hover:!shadow-xl !hover:scale-101 !transition-all !duration-200"
						></p-button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Filters & Search Section -->
	<div class="mb-6 sm:mb-8">
		<div class="bg-white rounded-2xlborder border-slate-200/60 p-6">
			<!-- Filters Grid -->
			<div class="flex gap-12">
				<!-- Movie Filter -->
				<div class="space-y-2">
					<label
						class="flex items-center gap-2 text-sm font-semibold text-slate-700"
					>
						<i class="pi pi-video text-blue-500"></i>
						Movies screening now
					</label>
					<div class="flex items-center gap-2">
						<p-dropdown
							[options]="movies"
							optionLabel="name"
							optionValue="id"
							placeholder="All Movies"
							[showClear]="true"
							[(ngModel)]="searchMovieId"
							(ngModelChange)="onMovieFilterChange($event)"
							styleClass="!w-64"
						></p-dropdown>
						<p-button
							label="View Screening by Movie"
							icon="pi pi-search"
							styleClass="!bg-blue-500 !border-blue-500 !text-white hover:!bg-blue-600"
							(click)="openViewScreeningsByMovie()"
							[disabled]="!searchMovieId"
						></p-button>
					</div>
				</div>

				<!-- Theatre Filter -->
				<div class="space-y-2">
					<label
						class="flex items-center gap-2 text-sm font-semibold text-slate-700"
					>
						<i class="pi pi-building text-blue-500"></i>
						Theatre
					</label>
					<div class="flex items-center gap-2">
						<p-dropdown
							[options]="theatres"
							optionLabel="name"
							optionValue="id"
							placeholder="All Theatres"
							[showClear]="true"
							[(ngModel)]="searchTheatreId"
							styleClass="!w-64"
						></p-dropdown>
						<p-button
							label="View Screening by Theatre"
							icon="pi pi-search"
							styleClass="!bg-blue-500 !border-blue-500 !text-white hover:!bg-blue-600"
							(click)="openViewScreeningsByTheatre()"
							[disabled]="!searchTheatreId"
						></p-button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Main Content Area -->
	<div>
		<!-- Loading State -->
		<div
			*ngIf="loading"
			class="bg-white rounded-2xl shadow-lg border border-slate-200/60 p-8 sm:p-12"
		>
			<div class="flex flex-col items-center justify-center space-y-6">
				<!-- Animated Background -->
				<div class="relative">
					<div
						class="absolute inset-0 bg-gradient-to-r from-blue-500/10 via-indigo-500/10 to-purple-500/10 rounded-full animate-pulse"
					></div>
					<p-progressSpinner
						strokeWidth="3"
						styleClass="!w-16 !h-16 relative z-10"
					></p-progressSpinner>
				</div>
				<div class="text-center space-y-2">
					<h3 class="text-xl font-bold text-slate-800">Loading Screenings</h3>
					<p class="text-slate-600">
						Please wait while we fetch the latest screening data...
					</p>
				</div>
			</div>
		</div>

		<!-- Tabs Container -->
		<div
			*ngIf="!loading"
			class="bg-white rounded-2xl shadow-lg border border-slate-200/60 overflow-hidden"
		>
			<!-- Tab Navigation -->
			<div class="border-b border-slate-200">
				<div class="p-6 pb-0">
					<p-tabView
						[(activeIndex)]="activeTabIndex"
						(onChange)="onTabChange($event)"
					>
						<p-tabPanel header="Current & Upcoming">
							<!-- Current & Upcoming Table -->
							<p-table
								[value]="getCurrentAndUpcomingScreenings()"
								[paginator]="false"
								[responsive]="true"
							>
								<ng-template pTemplate="header">
									<tr class="bg-slate-50">
										<th
											class="!p-4 !text-left !font-semibold !text-slate-700 !text-sm !border-b !border-slate-200"
										>
											<div class="flex items-center gap-2">
												<i class="pi pi-video text-blue-500"></i>
												Movie
											</div>
										</th>
										<th
											class="!p-4 !text-left !font-semibold !text-slate-700 !text-sm !border-b !border-slate-200"
										>
											<div class="flex items-center gap-2">
												<i class="pi pi-building text-blue-500"></i>
												Theatre & Hall
											</div>
										</th>
										<th
											class="!p-4 !text-left !font-semibold !text-slate-700 !text-sm !border-b !border-slate-200"
										>
											<div class="flex items-center gap-2">
												<i class="pi pi-clock text-blue-500"></i>
												Date & Time
											</div>
										</th>
										<th
											class="!p-4 !text-left !font-semibold !text-slate-700 !text-sm !border-b !border-slate-200"
										>
											<div class="flex items-center gap-2">
												<i class="pi pi-globe text-blue-500"></i>
												Languages
											</div>
										</th>
										<th
											class="!p-4 !text-left !font-semibold !text-slate-700 !text-sm !border-b !border-slate-200"
										>
											Pricing
										</th>
										<th
											class="!p-4 !text-left !font-semibold !text-slate-700 !text-sm !border-b !border-slate-200"
										>
											<div class="flex items-center gap-2">
												<i class="pi pi-info-circle text-blue-500"></i>
												Status
											</div>
										</th>
										<th
											class="!p-4 !text-center !font-semibold !text-slate-700 !text-sm !border-b !border-slate-200"
										>
											<div class="flex items-center justify-center gap-2">
												<i class="pi pi-cog text-blue-500"></i>
												Actions
											</div>
										</th>
									</tr>
								</ng-template>

								<ng-template
									pTemplate="body"
									let-screening
									let-rowIndex="rowIndex"
								>
									<tr
										class="border-b border-slate-100 hover:bg-slate-50/70 transition-colors duration-200"
									>
										<!-- Movie Column -->
										<td class="!p-4 !border-none">
											<div class="flex items-center gap-3">
												<div class="relative flex-shrink-0">
													<img
														*ngIf="getFirstPortraitImage(screening.movie)"
														[src]="
															getMediaUrl(
																getFirstPortraitImage(screening.movie).uri
															)
														"
														[alt]="screening.movie?.name"
														class="w-12 h-16 object-cover rounded-lg shadow-sm border border-slate-200"
														loading="lazy"
														(error)="onImageError($event)"
													/>
													<div
														*ngIf="!getFirstPortraitImage(screening.movie)"
														class="w-12 h-16 bg-slate-100 rounded-lg flex items-center justify-center border border-slate-200"
													>
														<i class="pi pi-image text-slate-400 text-lg"></i>
													</div>
												</div>
												<div class="min-w-0 flex-1">
													<div class="font-semibold text-slate-800 truncate">
														{{ screening.movie?.name }}
													</div>
													<div
														class="text-slate-500 text-sm flex items-center gap-1 mt-1"
													>
														<i class="pi pi-clock text-xs"></i>
														{{ screening.movie?.durationMin }}min
													</div>
												</div>
											</div>
										</td>

										<!-- Theatre & Hall Column -->
										<td class="!p-4 !border-none">
											<div class="space-y-1">
												<div class="font-semibold text-slate-800">
													{{ screening.hall?.theatre?.name }}
												</div>
												<div class="text-blue-600 font-medium text-sm">
													{{ screening.hall?.name }}
												</div>
												<div
													class="text-slate-500 text-xs flex items-center gap-1"
												>
													<i class="pi pi-users"></i>
													{{ screening.hall?.capacity }} seats
												</div>
											</div>
										</td>

										<!-- Date & Time Column -->
										<td class="!p-4 !border-none">
											<div class="space-y-1">
												<div
													class="flex items-center gap-2 text-slate-800 font-medium"
												>
													<i class="pi pi-calendar text-blue-500 text-sm"></i>
													{{ screening.date | date : "mediumDate" }}
												</div>
												<div
													class="flex items-center gap-2 text-slate-600 text-sm"
												>
													<i class="pi pi-clock text-blue-500 text-sm"></i>
													{{ formatTime(screening.startTime) }} -
													{{ formatTime(screening.endTime) }}
												</div>
											</div>
										</td>

										<!-- Languages Column -->
										<td class="!p-4 !border-none">
											<div class="space-y-2">
												<div
													*ngIf="screening.audioLanguage"
													class="flex items-center gap-2"
												>
													<span
														class="px-2 py-1 bg-blue-100 text-blue-800 rounded-md text-xs font-medium"
													>
														<i class="pi pi-volume-up text-xs mr-1"></i>
														{{ screening.audioLanguage.name }}
													</span>
												</div>
												<div
													*ngIf="screening.subtitleLanguage"
													class="flex items-center gap-2"
												>
													<span
														class="px-2 py-1 bg-slate-100 text-slate-700 rounded-md text-xs font-medium"
													>
														<i class="pi pi-file-o text-xs mr-1"></i>
														{{ screening.subtitleLanguage.name }}
													</span>
												</div>
												<div
													*ngIf="
														!screening.audioLanguage &&
														!screening.subtitleLanguage
													"
													class="text-slate-400 text-sm italic"
												>
													No languages set
												</div>
											</div>
										</td>

										<!-- Pricing Column -->
										<td class="!p-4 !border-none">
											<div class="space-y-1">
												<div
													*ngFor="let item of screening.screeningSeatPrices"
													class="text-sm"
												>
													<span class="text-slate-600"
														>{{ item.seatCategory.name }}:</span
													>
													<span class="font-semibold text-slate-800 ml-1">
														{{
															item.price | currency : "BTN" : "symbol" : "1.0-0"
														}}
													</span>
												</div>
											</div>
										</td>

										<!-- Status Column -->
										<td class="!p-4 !border-none">
											<p-tag
												[value]="
													getScreeningSeverity(screening) === 'secondary'
														? 'Screening Now'
														: getScreeningSeverity(screening) === 'warning'
														? 'Screening Now'
														: 'Upcoming'
												"
												[severity]="getScreeningSeverity(screening)"
												styleClass="!px-3 !py-1 !rounded-full !font-medium !text-xs"
												[icon]="
													getScreeningSeverity(screening) === 'secondary'
														? 'pi pi-check-circle'
														: getScreeningSeverity(screening) === 'warning'
														? 'pi pi-clock'
														: 'pi pi-calendar-plus'
												"
											></p-tag>
										</td>

										<!-- Actions Column -->
										<td class="!p-4 !border-none">
											<div class="flex items-center justify-center gap-2">
												<p-button
													icon="pi pi-eye"
													styleClass="!bg-blue-50 !border-blue-200 !text-blue-600 hover:!bg-blue-100 !rounded-lg !p-2 !w-8 !h-8"
													pTooltip="View Details"
													tooltipPosition="top"
													(onClick)="openDetailDialog(screening)"
												></p-button>
											</div>
										</td>
									</tr>
								</ng-template>

								<ng-template pTemplate="emptymessage">
									<tr>
										<td colspan="7" class="!p-12 !text-center !border-none">
											<div
												class="flex flex-col items-center justify-center space-y-4"
											>
												<div
													class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center"
												>
													<i class="pi pi-play text-green-500 text-2xl"></i>
												</div>
												<div class="space-y-2">
													<h4 class="text-xl font-semibold text-slate-700">
														No current or upcoming screenings found
													</h4>
													<p class="text-slate-500 max-w-md">
														Try adjusting your filters or create a new screening
														to get started
													</p>
												</div>
											</div>
										</td>
									</tr>
								</ng-template>
							</p-table>

							<!-- Current Screenings Pagination -->
							<div
								*ngIf="
									currentScreeningsPagination &&
									currentScreeningsPagination.pagination.totalCount > 0
								"
								class="p-6 border-t border-slate-200 bg-slate-50/30"
							>
								<p-paginator
									appendTo="body"
									[first]="
										(currentScreeningsPage - 1) * currentScreeningsPageSize
									"
									[rows]="currentScreeningsPageSize"
									[totalRecords]="
										currentScreeningsPagination.pagination.totalCount
									"
									[rowsPerPageOptions]="[5, 10, 25, 50]"
									(onPageChange)="onCurrentPageChange($event)"
									styleClass="!border-none !bg-transparent"
									[showCurrentPageReport]="true"
									currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
								></p-paginator>
							</div>
						</p-tabPanel>

						<p-tabPanel header="Past">
							<!-- Past Screenings Table -->
							<p-table
								[value]="getPastScreenings()"
								[paginator]="false"
								[responsive]="true"
								styleClass="!border-none"
							>
								<ng-template pTemplate="header">
									<tr class="bg-slate-50">
										<th
											class="!p-4 !text-left !font-semibold !text-slate-700 !text-sm !border-b !border-slate-200"
										>
											<div class="flex items-center gap-2">
												<i class="pi pi-video text-blue-500"></i>
												Movies
											</div>
										</th>
										<th
											class="!p-4 !text-left !font-semibold !text-slate-700 !text-sm !border-b !border-slate-200"
										>
											<div class="flex items-center gap-2">
												<i class="pi pi-building text-blue-500"></i>
												Theatre & Hall
											</div>
										</th>
										<th
											class="!p-4 !text-left !font-semibold !text-slate-700 !text-sm !border-b !border-slate-200"
										>
											<div class="flex items-center gap-2">
												<i class="pi pi-clock text-blue-500"></i>
												Date & Time
											</div>
										</th>
										<th
											class="!p-4 !text-left !font-semibold !text-slate-700 !text-sm !border-b !border-slate-200"
										>
											<div class="flex items-center gap-2">
												<i class="pi pi-globe text-blue-500"></i>
												Languages
											</div>
										</th>
										<th
											class="!p-4 !text-left !font-semibold !text-slate-700 !text-sm !border-b !border-slate-200"
										>
											Pricing
										</th>
										<th
											class="!p-4 !text-left !font-semibold !text-slate-700 !text-sm !border-b !border-slate-200"
										>
											<div class="flex items-center gap-2">
												<i class="pi pi-check-circle text-slate-500"></i>
												Completed
											</div>
										</th>
										<th
											class="!p-4 !text-center !font-semibold !text-slate-700 !text-sm !border-b !border-slate-200"
										>
											<div class="flex items-center justify-center gap-2">
												<i class="pi pi-cog text-blue-500"></i>
												Actions
											</div>
										</th>
									</tr>
								</ng-template>

								<ng-template
									pTemplate="body"
									let-screening
									let-rowIndex="rowIndex"
								>
									<tr
										class="border-b border-slate-100 hover:bg-slate-50/70 transition-colors duration-200 opacity-75"
									>
										<!-- Movie Column -->
										<td class="!p-4 !border-none">
											<div class="flex items-center gap-3">
												<div class="relative flex-shrink-0">
													<img
														*ngIf="getFirstPortraitImage(screening.movie)"
														[src]="
															getMediaUrl(
																getFirstPortraitImage(screening.movie).uri
															)
														"
														[alt]="screening.movie?.name"
														class="w-12 h-16 object-cover rounded-lg shadow-sm border border-slate-200"
														loading="lazy"
														(error)="onImageError($event)"
													/>
													<div
														*ngIf="!getFirstPortraitImage(screening.movie)"
														class="w-12 h-16 bg-slate-100 rounded-lg flex items-center justify-center border border-slate-200"
													>
														<i class="pi pi-image text-slate-400 text-lg"></i>
													</div>
												</div>
												<div class="min-w-0 flex-1">
													<div class="font-semibold text-slate-800 truncate">
														{{ screening.movie?.name }}
													</div>
													<div
														class="text-slate-500 text-sm flex items-center gap-1 mt-1"
													>
														<i class="pi pi-clock text-xs"></i>
														{{ screening.movie?.durationMin }}min
													</div>
												</div>
											</div>
										</td>

										<!-- Theatre & Hall Column -->
										<td class="!p-4 !border-none">
											<div class="space-y-1">
												<div class="font-semibold text-slate-800">
													{{ screening.hall?.theatre?.name }}
												</div>
												<div class="text-blue-600 font-medium text-sm">
													{{ screening.hall?.name }}
												</div>
												<div
													class="text-slate-500 text-xs flex items-center gap-1"
												>
													<i class="pi pi-users"></i>
													{{ screening.hall?.capacity }} seats
												</div>
											</div>
										</td>

										<!-- Date & Time Column -->
										<td class="!p-4 !border-none">
											<div class="space-y-1">
												<div
													class="flex items-center gap-2 text-slate-800 font-medium"
												>
													<i class="pi pi-calendar text-blue-500 text-sm"></i>
													{{ screening.date | date : "mediumDate" }}
												</div>
												<div
													class="flex items-center gap-2 text-slate-600 text-sm"
												>
													<i class="pi pi-clock text-blue-500 text-sm"></i>
													{{ formatTime(screening.startTime) }} -
													{{ formatTime(screening.endTime) }}
												</div>
											</div>
										</td>

										<!-- Languages Column -->
										<td class="!p-4 !border-none">
											<div class="space-y-2">
												<div
													*ngIf="screening.audioLanguage"
													class="flex items-center gap-2"
												>
													<span
														class="px-2 py-1 bg-blue-100 text-blue-800 rounded-md text-xs font-medium"
													>
														<i class="pi pi-volume-up text-xs mr-1"></i>
														{{ screening.audioLanguage.name }}
													</span>
												</div>
												<div
													*ngIf="screening.subtitleLanguage"
													class="flex items-center gap-2"
												>
													<span
														class="px-2 py-1 bg-slate-100 text-slate-700 rounded-md text-xs font-medium"
													>
														<i class="pi pi-file-o text-xs mr-1"></i>
														{{ screening.subtitleLanguage.name }}
													</span>
												</div>
												<div
													*ngIf="
														!screening.audioLanguage &&
														!screening.subtitleLanguage
													"
													class="text-slate-400 text-sm italic"
												>
													No languages set
												</div>
											</div>
										</td>

										<!-- Pricing Column -->
										<td class="!p-4 !border-none">
											<div class="space-y-1">
												<div
													*ngFor="let item of screening.screeningSeatPrices"
													class="text-sm"
												>
													<span class="text-slate-600"
														>{{ item.seatCategory.name }}:</span
													>
													<span class="font-semibold text-slate-800 ml-1">
														{{
															item.price | currency : "BTN" : "symbol" : "1.0-0"
														}}
													</span>
												</div>
											</div>
										</td>

										<!-- Status Column -->
										<td class="!p-4 !border-none">
											<p-tag
												value="Completed"
												severity="success"
												styleClass="!px-3 !py-1 !rounded-full !font-medium !text-xs"
												icon="pi pi-check-circle"
											></p-tag>
										</td>

										<!-- Actions Column -->
										<td class="!p-4 !border-none">
											<div class="flex items-center justify-center gap-2">
												<p-button
													icon="pi pi-eye"
													styleClass="!bg-blue-50 !border-blue-200 !text-blue-600 hover:!bg-blue-100 !rounded-lg !p-2 !w-8 !h-8"
													pTooltip="View Details"
													tooltipPosition="top"
													(onClick)="openDetailDialog(screening)"
												></p-button>
											</div>
										</td>
									</tr>
								</ng-template>

								<ng-template pTemplate="emptymessage">
									<tr>
										<td colspan="7" class="!p-12 !text-center !border-none">
											<div
												class="flex flex-col items-center justify-center space-y-4"
											>
												<div
													class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center"
												>
													<i class="pi pi-history text-slate-400 text-2xl"></i>
												</div>
												<div class="space-y-2">
													<h4 class="text-xl font-semibold text-slate-700">
														No past screenings found
													</h4>
													<p class="text-slate-500 max-w-md">
														Past screenings will appear here once they are
														completed
													</p>
												</div>
											</div>
										</td>
									</tr>
								</ng-template>
							</p-table>

							<!-- Past Screenings Pagination -->
							<div
								*ngIf="
									pastScreeningsPagination &&
									pastScreeningsPagination.pagination.totalCount > 0
								"
								class="p-6 border-t border-slate-200 bg-slate-50/30"
							>
								<p-paginator
									appendTo="body"
									[first]="(pastScreeningsPage - 1) * pastScreeningsPageSize"
									[rows]="pastScreeningsPageSize"
									[totalRecords]="
										pastScreeningsPagination.pagination.totalCount
									"
									[rowsPerPageOptions]="[5, 10, 25, 50]"
									(onPageChange)="onPastPageChange($event)"
									styleClass="!border-none !bg-transparent"
									[showCurrentPageReport]="true"
									currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
								></p-paginator>
							</div>
						</p-tabPanel>
					</p-tabView>
				</div>
			</div>
		</div>

		<!-- Confirmation Dialog -->
		<p-confirmDialog styleClass="!rounded-2xl"></p-confirmDialog>

		<!-- Toast Messages -->
		<p-toast></p-toast>
	</div>
</div>
