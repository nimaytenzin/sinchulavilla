<!-- Screening Detailed View -->
<div class="overflow-auto bg-white screening-detail-container">
	<!-- Loading State -->
	<div *ngIf="loading" class="flex items-center justify-center py-12">
		<p-progressSpinner
			strokeWidth="3"
			styleClass="!w-12 !h-12"
		></p-progressSpinner>
	</div>

	<!-- Content -->
	<div *ngIf="!loading && screening" class="p-6">
		<!-- Header with Movie Info -->
		<div class="flex gap-6 mb-8">
			<!-- Movie Poster -->
			<div class="flex-shrink-0">
				<img
					*ngIf="getFirstPortraitImage(screening.movie)"
					[src]="getMediaUrl(getFirstPortraitImage(screening.movie).uri)"
					[alt]="screening.movie.name"
					class="w-32 h-48 object-cover rounded-lg shadow-lg"
					(error)="onImageError($event)"
				/>
				<div
					*ngIf="!getFirstPortraitImage(screening.movie)"
					class="w-32 h-48 bg-slate-200 rounded-lg flex items-center justify-center"
				>
					<i class="pi pi-image text-slate-400 text-3xl"></i>
				</div>
			</div>

			<!-- Movie & Screening Details -->
			<div class="flex-1">
				<h1 class="text-2xl font-bold text-slate-800 mb-2">
					{{ screening.movie.name }}
				</h1>

				<div class="flex items-center gap-4 text-slate-600 mb-4">
					<span class="flex items-center gap-1">
						<i class="pi pi-clock text-sm"></i>
						{{ screening.movie.durationMin }}min
					</span>
					<span class="flex items-center gap-1">
						<i class="pi pi-star-fill text-yellow-500 text-sm"></i>
						{{ screening.movie.pgRating || "Not Rated" }}
					</span>
					<p-tag
						[value]="getScreeningStatus().label"
						[severity]="getScreeningStatus().severity"
						[icon]="getScreeningStatus().icon"
						styleClass="!px-3 !py-1 !text-xs !font-medium !rounded-full"
					></p-tag>
				</div>

				<!-- Basic Details Grid -->
				<div class="grid grid-cols-2 gap-6 text-sm">
					<div>
						<label class="font-medium text-slate-700">Date</label>
						<p class="text-slate-900">{{ formatDate(screening.date) }}</p>
					</div>
					<div>
						<label class="font-medium text-slate-700">Show Time</label>
						<p class="text-slate-900">
							{{ formatTime(screening.startTime) }} -
							{{ formatTime(screening.endTime) }}
						</p>
					</div>
					<div>
						<label class="font-medium text-slate-700">Theatre</label>
						<p class="text-slate-900">{{ screening.hall.theatre.name }}</p>
					</div>
					<div>
						<label class="font-medium text-slate-700">Hall</label>
						<p class="text-slate-900">
							{{ screening.hall.name }} ({{ screening.hall.capacity }} seats)
						</p>
					</div>
				</div>
			</div>
		</div>

		<!-- Languages -->
		<div *ngIf="screening.audioLanguage || screening.subtitleLanguage">
			<h3 class="text-lg font-semibold text-slate-800 mb-3">Languages</h3>
			<div class="flex gap-3">
				<span
					*ngIf="screening.audioLanguage"
					class="inline-flex items-center gap-2 px-3 py-1 bg-blue-100 text-blue-800 rounded text-sm"
				>
					<i class="pi pi-volume-up"></i>
					{{ screening.audioLanguage.name }}
				</span>
				<span
					*ngIf="screening.subtitleLanguage"
					class="inline-flex items-center gap-2 px-3 py-1 bg-slate-100 text-slate-700 rounded text-sm"
				>
					<i class="pi pi-file-o"></i>
					{{ screening.subtitleLanguage.name }}
				</span>
			</div>
		</div>

		<!-- Seat Pricing -->
		<div
			*ngIf="
				screening.screeningSeatPrices &&
				screening.screeningSeatPrices.length > 0
			"
		>
			<h3 class="text-lg font-semibold text-slate-800 mb-3">Seat Pricing</h3>
			<div class="grid grid-cols-2 md:grid-cols-3 gap-3">
				<div
					*ngFor="let seatPrice of screening.screeningSeatPrices"
					class="flex items-center justify-between p-3 bg-slate-50 rounded border"
				>
					<span class="font-medium text-slate-700">{{
						seatPrice.seatCategory?.name
					}}</span>
					<span class="font-bold text-green-600">
						{{ seatPrice.price | currency : "BTN" : "symbol" : "1.0-0" }}
					</span>
				</div>
			</div>
		</div>

		<!-- Tab View -->
		<div class="mt-8">
			<p-tabView
				[(activeIndex)]="activeTabIndex"
				styleClass="screening-detail-tabs"
			>
				<!-- Booking Summary Tab -->
				<p-tabPanel header="Booking Summary">
					<div class="pt-4">
						<!-- Loading State -->
						<div
							*ngIf="bookingsLoading"
							class="flex items-center justify-center py-8"
						>
							<p-progressSpinner
								strokeWidth="3"
								styleClass="!w-8 !h-8"
							></p-progressSpinner>
							<span class="ml-3 text-slate-600">Calculating summary...</span>
						</div>

						<!-- Summary Cards -->
						<div
							*ngIf="!bookingsLoading"
							class="grid grid-cols-2 lg:grid-cols-4 gap-3 mb-6"
						>
							<!-- Total Bookings -->
							<div
								class="bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-lg p-3"
							>
								<div class="flex items-center justify-between">
									<div>
										<p class="text-blue-600 text-xs font-medium mb-1">
											Total Bookings
										</p>
										<p class="text-xl font-bold text-blue-800">
											{{ bookingSummary.totalBookings }}
										</p>
									</div>
									<div
										class="w-8 h-8 bg-blue-200 rounded-lg flex items-center justify-center"
									>
										<i class="pi pi-ticket text-blue-600 text-sm"></i>
									</div>
								</div>
							</div>

							<!-- Seats Booked -->
							<div
								class="bg-gradient-to-br from-green-50 to-green-100 border border-green-200 rounded-lg p-3"
							>
								<div class="flex items-center justify-between">
									<div>
										<p class="text-green-600 text-xs font-medium mb-1">
											Seats Booked
										</p>
										<p class="text-xl font-bold text-green-800">
											{{ bookingSummary.totalSeatsBooked }}
										</p>
										<p class="text-xs text-green-600">
											of {{ screening.hall.capacity || 0 }} total
										</p>
									</div>
									<div
										class="w-8 h-8 bg-green-200 rounded-lg flex items-center justify-center"
									>
										<i class="pi pi-users text-green-600 text-sm"></i>
									</div>
								</div>
							</div>

							<!-- Revenue Generated -->
							<div
								class="bg-gradient-to-br from-purple-50 to-purple-100 border border-purple-200 rounded-lg p-3"
							>
								<div class="flex items-center justify-between">
									<div>
										<p class="text-purple-600 text-xs font-medium mb-1">
											Revenue
										</p>
										<p class="text-xl font-bold text-purple-800">
											{{
												bookingSummary.totalRevenue
													| currency : "BTN" : "symbol" : "1.0-0"
											}}
										</p>
									</div>
									<div
										class="w-8 h-8 bg-purple-200 rounded-lg flex items-center justify-center"
									>
										<i class="pi pi-money-bill text-purple-600 text-sm"></i>
									</div>
								</div>
							</div>

							<!-- Occupancy Percentage -->
							<div
								class="bg-gradient-to-br from-orange-50 to-orange-100 border border-orange-200 rounded-lg p-3"
							>
								<div class="flex items-center justify-between">
									<div>
										<p class="text-orange-600 text-xs font-medium mb-1">
											Occupancy
										</p>
										<p class="text-xl font-bold text-orange-800">
											{{ bookingSummary.occupancyPercentage }}%
										</p>
									</div>
									<div
										class="w-8 h-8 bg-orange-200 rounded-lg flex items-center justify-center"
									>
										<i class="pi pi-chart-pie text-orange-600 text-sm"></i>
									</div>
								</div>
							</div>
						</div>

						<p class="mt-4">All Bookings</p>

						<!-- Bookings Table -->

						<div *ngIf="!bookingsLoading && bookings.length > 0">
							<p-table
								[value]="bookings"
								[responsive]="true"
								[paginator]="true"
								[rows]="5"
								[rowsPerPageOptions]="[5, 10, 25, 50]"
								[showCurrentPageReport]="true"
								currentPageReportTemplate="Showing {first} to {last} of {totalRecords} bookings"
								styleClass="!border-none"
							>
								<ng-template pTemplate="header">
									<tr class="bg-slate-50">
										<th
											class="!p-3 !text-left !font-medium !text-slate-700 !text-sm"
										>
											Booking ID
										</th>
										<th
											class="!p-3 !text-left !font-medium !text-slate-700 !text-sm"
										>
											Customer
										</th>
										<th
											class="!p-3 !text-left !font-medium !text-slate-700 !text-sm"
										>
											Seats
										</th>
										<th
											class="!p-3 !text-left !font-medium !text-slate-700 !text-sm"
										>
											Amount
										</th>
										<th
											class="!p-3 !text-left !font-medium !text-slate-700 !text-sm"
										>
											Status
										</th>
										<th
											class="!p-3 !text-left !font-medium !text-slate-700 !text-sm"
										>
											Booking Date
										</th>
									</tr>
								</ng-template>
								<ng-template pTemplate="body" let-booking>
									<tr class="border-b border-slate-100 hover:bg-slate-50/70">
										<td class="!p-3 !border-none">
											<span class="font-mono text-sm text-blue-600"
												>#{{ booking.id }}</span
											>
										</td>
										<td class="!p-3 !border-none">
											<div>
												<div class="font-medium text-slate-800">
													{{ booking.name || "N/A" }}
												</div>
												<div class="text-sm text-slate-500">
													{{ booking.phoneNumber || "" }}
												</div>
											</div>
										</td>
										<td class="!p-3 !border-none">
											<div class="flex flex-wrap gap-1">
												<span
													*ngFor="
														let bookingSeat of booking.bookingSeats;
														let last = last
													"
													class="inline-flex items-center px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs font-medium"
												>
													{{ bookingSeat.seat.seatNumber }}
												</span>
											</div>
											<div class="text-xs text-slate-500 mt-1">
												{{ booking.bookingSeats?.length || 0 }} seat(s)
											</div>
										</td>
										<td class="!p-3 !border-none">
											<span class="font-semibold text-green-600">
												{{
													booking.amount | currency : "BTN" : "symbol" : "1.0-0"
												}}
											</span>
										</td>
										<td class="!p-3 !border-none">
											<p-tag
												[value]="booking.bookingStatus"
												[severity]="
													booking.bookingStatus === 'CONFIRMED'
														? 'success'
														: 'danger'
												"
												styleClass="!px-2 !py-1 !text-xs !rounded-full"
											></p-tag>
										</td>
										<td class="!p-3 !border-none">
											<span class="text-sm text-slate-600">
												{{ booking.createdAt | date : "short" }}
											</span>
										</td>
									</tr>
								</ng-template>
							</p-table>
						</div>

						<!-- Empty State -->
						<div
							*ngIf="!bookingsLoading && bookings.length === 0"
							class="text-center py-12"
						>
							<div
								class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4"
							>
								<i class="pi pi-ticket text-slate-400 text-2xl"></i>
							</div>
							<h4 class="text-lg font-medium text-slate-700 mb-2">
								No Bookings Found
							</h4>
							<p class="text-slate-500">
								No bookings have been made for this screening yet.
							</p>
						</div>
					</div>
				</p-tabPanel>
			</p-tabView>
		</div>
		<!-- Action Buttons -->
		<div
			class="flex items-center justify-end gap-3 pt-6 mt-8 border-t border-slate-200"
		>
			<p-button
				label="Close"
				icon="pi pi-times"
				styleClass="!bg-slate-100 !border-slate-200 !text-slate-700 hover:!bg-slate-200"
				(onClick)="close()"
			></p-button>
			<p-button
				label="Edit Screening"
				icon="pi pi-pencil"
				styleClass="!bg-blue-500 !border-blue-500 !text-white hover:!bg-blue-600"
				(onClick)="editScreening()"
			></p-button>
		</div>
	</div>

	<!-- Error State -->
	<div
		*ngIf="!loading && !screening"
		class="flex flex-col items-center justify-center py-12 text-center"
	>
		<div
			class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4"
		>
			<i class="pi pi-exclamation-triangle text-red-500 text-2xl"></i>
		</div>
		<h3 class="text-lg font-semibold text-slate-700 mb-2">
			Screening Not Found
		</h3>
		<p class="text-slate-500 mb-4">
			The requested screening details could not be loaded.
		</p>
		<p-button
			label="Close"
			icon="pi pi-times"
			styleClass="!bg-slate-100 !border-slate-200 !text-slate-700 hover:!bg-slate-200"
			(onClick)="close()"
		></p-button>
	</div>
</div>
